<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Urlaubskalender</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f4f4;
    }
    header {
      background: #2c3e50;
      color: #fff;
      padding: 10px;
      text-align: center;
    }
    .controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 15px;
      flex-wrap: wrap;
    }
    button {
      padding: 8px 14px;
      border: none;
      border-radius: 8px;
      background: #3498db;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background: #2980b9;
    }
    #calendar {
      margin: 20px auto;
      max-width: 1000px;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      border: 1px solid #ddd;
      text-align: center;
      padding: 5px;
      min-width: 30px;
      min-height: 30px;
    }
    th {
      background: #eee;
    }
    .year-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
    }
    .month-box {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
    }
    .month-box h3 {
      margin: 0 0 5px;
      text-align: center;
    }
    .entry {
      display: inline-block;
      padding: 2px 5px;
      border-radius: 4px;
      margin: 1px;
      font-size: 12px;
      color: white;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <script>
    // ðŸ”‘ Passwortschutz
    const pass = "2400";
    let input = prompt("Bitte Passwort eingeben:");
    if (input !== pass) {
      document.body.innerHTML = "<h2 style='text-align:center;margin-top:50px;'>Zugriff verweigert</h2>";
      throw new Error("Falsches Passwort");
    }
  </script>

  <header>
    <h1>Urlaubskalender</h1>
  </header>

  <div class="controls">
    <button onclick="prev()">â—€ ZurÃ¼ck</button>
    <button onclick="today()">Heute</button>
    <button onclick="next()">Vor â–¶</button>
    <button onclick="toggleView()">Ansicht wechseln</button>
  </div>

  <div id="calendar"></div>

  <script>
    // ---- UrsprÃ¼ngliche Datenstruktur ----
    let state = JSON.parse(localStorage.getItem("urlaubskalender")) || {
      members: [],
      entries: []
    };

    let currentDate = new Date();
    let viewMode = "month"; // "month" oder "year"

    // ---- Rendering ----
    function render() {
      const container = document.getElementById("calendar");
      container.innerHTML = "";

      if (viewMode === "month") {
        renderMonth(currentDate, container);
      } else {
        renderYear(currentDate.getFullYear(), container);
      }

      localStorage.setItem("urlaubskalender", JSON.stringify(state));
    }

    function renderMonth(date, container) {
      const year = date.getFullYear();
      const month = date.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);

      let table = "<h2 style='text-align:center'>" +
                  date.toLocaleString("de-DE", { month: "long" }) +
                  " " + year + "</h2>";
      table += "<table><thead><tr>";
      const days = ["Mo", "Di", "Mi", "Do", "Fr", "Sa", "So"];
      days.forEach(d => table += "<th>" + d + "</th>");
      table += "</tr></thead><tbody><tr>";

      let startDay = (firstDay.getDay() + 6) % 7;
      for (let i = 0; i < startDay; i++) {
        table += "<td></td>";
      }

      for (let d = 1; d <= lastDay.getDate(); d++) {
        const dow = (startDay + d - 1) % 7;
        table += "<td data-date='" + year + "-" + (month+1) + "-" + d + "'>" + d;
        // EintrÃ¤ge rendern
        state.entries.forEach(e => {
          const sd = new Date(e.start);
          const ed = new Date(e.end);
          const thisDay = new Date(year, month, d);
          if (thisDay >= sd && thisDay <= ed) {
            const member = state.members.find(m => m.id === e.memberId);
            if (member) {
              table += "<div class='entry' style='background:" + member.color + "'>" +
                       member.name + "</div>";
            }
          }
        });
        table += "</td>";
        if (dow === 6 && d !== lastDay.getDate()) {
          table += "</tr><tr>";
        }
      }

      table += "</tr></tbody></table>";
      container.innerHTML = table;
    }

    function renderYear(year, container) {
      let html = "<h2 style='text-align:center'>Jahresansicht " + year + "</h2>";
      html += "<div class='year-grid'>";

      for (let m = 0; m < 12; m++) {
        const date = new Date(year, m, 1);
        const firstDay = new Date(year, m, 1);
        const lastDay = new Date(year, m + 1, 0);

        let table = "<div class='month-box'><h3>" +
                    date.toLocaleString("de-DE", { month: "long" }) +
                    "</h3>";
        table += "<table><thead><tr>";
        const days = ["Mo", "Di", "Mi", "Do", "Fr", "Sa", "So"];
        days.forEach(d => table += "<th>" + d + "</th>");
        table += "</tr></thead><tbody><tr>";

        let startDay = (firstDay.getDay() + 6) % 7;
        for (let i = 0; i < startDay; i++) {
          table += "<td></td>";
        }

        for (let d = 1; d <= lastDay.getDate(); d++) {
          const dow = (startDay + d - 1) % 7;
          table += "<td>" + d;
          // Auch hier EintrÃ¤ge anzeigen
          state.entries.forEach(e => {
            const sd = new Date(e.start);
            const ed = new Date(e.end);
            const thisDay = new Date(year, m, d);
            if (thisDay >= sd && thisDay <= ed) {
              const member = state.members.find(m => m.id === e.memberId);
              if (member) {
                table += "<div class='entry' style='background:" + member.color + "'>" +
                         member.name + "</div>";
              }
            }
          });
          table += "</td>";
          if (dow === 6 && d !== lastDay.getDate()) {
            table += "</tr><tr>";
          }
        }

        table += "</tr></tbody></table></div>";
        html += table;
      }

      html += "</div>";
      container.innerHTML = html;
    }

    // ---- Navigation ----
    function prev() {
      if (viewMode === "month") {
        currentDate.setMonth(currentDate.getMonth() - 1);
      } else {
        currentDate.setFullYear(currentDate.getFullYear() - 1);
      }
      render();
    }

    function next() {
      if (viewMode === "month") {
        currentDate.setMonth(currentDate.getMonth() + 1);
      } else {
        currentDate.setFullYear(currentDate.getFullYear() + 1);
      }
      render();
    }

    function today() {
      currentDate = new Date();
      render();
    }

    function toggleView() {
      viewMode = (viewMode === "month") ? "year" : "month";
      render();
    }

    // Initial render
    render();
  </script>
</body>
</html>
