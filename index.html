<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Urlaubskalender / Team-Planer</title>
  <meta name="description" content="Ein einfacher, datenschutzfreundlicher Urlaubskalender für kleine Teams. Läuft komplett im Browser (LocalStorage) und kann über GitHub Pages gehostet werden." />
  <style>
    body {
      font-family: system-ui, Arial, sans-serif;
      margin: 0;
      background: #f4f6f9;
      color: #333;
    }
    header {
      background: #004080;
      color: #fff;
      padding: 10px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    header h1 { font-size: 20px; margin: 0; }
    .toolbar button {
      margin-left: 5px;
      padding: 6px 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .toolbar .secondary { background: #fff; color: #004080; }
    .toolbar .danger { background: #c00; color: #fff; }
    .toolbar button:hover { opacity: 0.8; }
    .grid {
      display: grid;
      grid-template-columns: 1fr 3fr;
      gap: 20px;
      padding: 20px;
    }
    .card {
      background: #fff;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    h2 { margin-top: 0; font-size: 18px; }
    ul { list-style: none; padding: 0; }
    li { margin-bottom: 6px; }
    label { display: block; margin-top: 10px; font-size: 14px; }
    input, select, textarea {
      width: 100%;
      padding: 6px;
      margin-top: 3px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    button { font-size: 14px; }
    .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; }
    .calendar .day {
      min-height: 80px;
      background: #fff;
      border: 1px solid #ddd;
      padding: 2px;
      font-size: 12px;
      position: relative;
    }
    .calendar .day .num { font-weight: bold; }
    .entry {
      margin: 2px 0;
      padding: 2px 4px;
      border-radius: 4px;
      font-size: 11px;
      color: #fff;
      cursor: pointer;
    }
    .year-view {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    .month-mini {
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 5px;
      background: #fff;
    }
    .month-mini h3 {
      margin: 0;
      font-size: 14px;
      text-align: center;
      background: #eee;
      border-radius: 4px;
    }
    .month-mini .calendar .day { min-height: 20px; font-size: 10px; }
  </style>
</head>
<body>
  <!-- PASSWORT -->
  <script>
    (function(){
      const pass = "2400";
      const input = prompt("Bitte Passwort eingeben:");
      if (input !== pass) {
        document.body.innerHTML = "<div style='padding:40px;color:#fff;text-align:center;font-family:system-ui,Arial,Helvetica'><h2>Zugriff verweigert</h2><p>Falsches Passwort</p></div>";
        throw new Error("Falsches Passwort");
      }
    })();
  </script>

  <div class="app">
    <header>
      <h1>Urlaubskalender / Team-Planer</h1>
      <div class="toolbar">
        <button id="btnToggleView">Jahr/Monat</button>
        <button id="btnToday">Heute</button>
        <button id="btnExport" class="secondary">Export</button>
        <button id="btnImport" class="secondary">Import</button>
        <button id="btnICS" class="secondary">iCalendar (.ics)</button>
        <button id="btnReset" class="danger">Zurücksetzen</button>
        <input type="file" id="fileImport" accept="application/json" style="display:none" />
      </div>
    </header>

    <div class="grid">
      <!-- linke Spalte -->
      <div>
        <div class="card">
          <h2>Teammitglieder</h2>
          <ul id="memberList"></ul>
          <label>Name <input type="text" id="memberName" /></label>
          <label>Farbe <input type="color" id="memberColor" value="#007bff" /></label>
          <button id="addMember">Hinzufügen</button>
        </div>

        <div class="card">
          <h2>Eintrag hinzufügen</h2>
          <label>Person
            <select id="entryMember"></select>
          </label>
          <label>Start <input type="date" id="entryStart"></label>
          <label>Ende <input type="date" id="entryEnd"></label>
          <label>Typ
            <select id="entryType">
              <option value="Urlaub">Urlaub</option>
              <option value="Krank">Krank</option>
              <option value="Homeoffice">Homeoffice</option>
            </select>
          </label>
          <label>Notiz <textarea id="entryNote"></textarea></label>
          <button id="addEntry">Einfügen</button>
        </div>

        <div class="card">
          <h2>Gespeicherte Einträge</h2>
          <ul id="entryList"></ul>
        </div>
      </div>

      <!-- rechte Spalte -->
      <div>
        <div class="card">
          <h2>Kalender <span id="currentMonthLabel"></span></h2>
          <div id="calendar"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ---------------- Daten ----------------
    let state = { members: [], entries: [], currentDate: new Date(), yearView: false };

    function saveState() { localStorage.setItem("urlaubskalender", JSON.stringify(state)); }
    function loadState() {
      const d = localStorage.getItem("urlaubskalender");
      if (d) state = JSON.parse(d);
    }
    loadState();

    // ---------------- UI-Render ----------------
    function renderAll() {
      renderMembers();
      renderEntries();
      renderCalendar();
    }

    function renderMembers() {
      const list = document.getElementById("memberList");
      const select = document.getElementById("entryMember");
      list.innerHTML = "";
      select.innerHTML = "";
      state.members.forEach(m => {
        const li = document.createElement("li");
        li.textContent = m.name;
        li.style.color = m.color;
        list.appendChild(li);

        const opt = document.createElement("option");
        opt.value = m.id;
        opt.textContent = m.name;
        select.appendChild(opt);
      });
    }

    function renderEntries() {
      const list = document.getElementById("entryList");
      list.innerHTML = "";
      state.entries.forEach(e => {
        const li = document.createElement("li");
        const member = state.members.find(m => m.id === e.memberId);
        li.textContent = `${member?.name || "?"}: ${e.start} – ${e.end} (${e.type}) ${e.note||""}`;
        li.style.color = member?.color || "#000";
        li.style.cursor = "pointer";
        li.onclick = () => { if (confirm("Eintrag löschen?")) { state.entries = state.entries.filter(x=>x.id!==e.id); saveState(); renderAll(); } };
        list.appendChild(li);
      });
    }

    function renderCalendar() {
      const cal = document.getElementById("calendar");
      cal.innerHTML = "";
      if (state.yearView) {
        const year = state.currentDate.getFullYear();
        const yearDiv = document.createElement("div");
        yearDiv.className = "year-view";
        for (let m=0;m<12;m++) {
          const d = new Date(year, m, 1);
          const monthDiv = document.createElement("div");
          monthDiv.className = "month-mini";
          const h3 = document.createElement("h3");
          h3.textContent = d.toLocaleString("de-DE",{month:"long"});
          monthDiv.appendChild(h3);
          monthDiv.appendChild(buildCalendar(d,true));
          yearDiv.appendChild(monthDiv);
        }
        cal.appendChild(yearDiv);
        document.getElementById("currentMonthLabel").textContent = year;
      } else {
        cal.appendChild(buildCalendar(state.currentDate,false));
        document.getElementById("currentMonthLabel").textContent = state.currentDate.toLocaleString("de-DE",{month:"long",year:"numeric"});
      }
    }

    function buildCalendar(date,mini) {
      const div = document.createElement("div");
      div.className="calendar";
      const year = date.getFullYear();
      const month = date.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month+1, 0);
      const startDay = firstDay.getDay()===0?7:firstDay.getDay();
      for (let i=1;i<startDay;i++){div.appendChild(document.createElement("div"));}
      for (let d=1;d<=lastDay.getDate();d++) {
        const dayDiv = document.createElement("div");
        dayDiv.className="day";
        const num = document.createElement("div");
        num.className="num";
        num.textContent=d;
        dayDiv.appendChild(num);
        const dateStr = `${year}-${String(month+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
        state.entries.forEach(e=>{
          if (e.start<=dateStr && e.end>=dateStr) {
            const member = state.members.find(m=>m.id===e.memberId);
            const entryDiv = document.createElement("div");
            entryDiv.className="entry";
            entryDiv.textContent=member?.name||"?";
            entryDiv.style.background=member?.color||"#000";
            entryDiv.title = `${e.type}\n${e.note||""}`;
            entryDiv.onclick = () => { if (confirm("Eintrag löschen?")) { state.entries = state.entries.filter(x=>x.id!==e.id); saveState(); renderAll(); } };
            dayDiv.appendChild(entryDiv);
          }
        });
        div.appendChild(dayDiv);
      }
      return div;
    }

    // ---------------- Aktionen ----------------
    document.getElementById("addMember").onclick = () => {
      const name = document.getElementById("memberName").value.trim();
      if (!name) return;
      const color = document.getElementById("memberColor").value;
      state.members.push({id:Date.now()+Math.random(),name,color});
      saveState(); renderAll();
    };

    document.getElementById("addEntry").onclick = () => {
      const memberId = parseFloat(document.getElementById("entryMember").value);
      const start = document.getElementById("entryStart").value;
      const end = document.getElementById("entryEnd").value;
      const type = document.getElementById("entryType").value;
      const note = document.getElementById("entryNote").value;
      if (!memberId||!start||!end) return;
      state.entries.push({id:Date.now()+Math.random(),memberId,start,end,type,note});
      saveState(); renderAll();
    };

    document.getElementById("btnToday").onclick = () => {
      state.currentDate = new Date();
      state.yearView=false;
      renderAll();
    };
    document.getElementById("btnToggleView").onclick = () => {
      state.yearView=!state.yearView;
      renderAll();
    };
    document.getElementById("btnReset").onclick = () => {
      if (confirm("Wirklich alles löschen?")) { state={members:[],entries:[],currentDate:new Date(),yearView:false}; saveState(); renderAll(); }
    };

    document.getElementById("btnExport").onclick = () => {
      const blob = new Blob([JSON.stringify(state)],{type:"application/json"});
      const a = document.createElement("a"); a.href=URL.createObjectURL(blob); a.download="urlaubskalender.json"; a.click();
    };
    document.getElementById("btnImport").onclick = () => { document.getElementById("fileImport").click(); };
    document.getElementById("fileImport").onchange = e => {
      const f=e.target.files[0]; if (!f) return;
      const r=new FileReader();
      r.onload = evt => { state=JSON.parse(evt.target.result); saveState(); renderAll(); };
      r.readAsText(f);
    };

    // ---------- ICS Export ----------
    function exportICS() {
      let ics = "BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Urlaubskalender//DE\n";
      state.entries.forEach(e => {
        const uid = e.id + "@urlaubskalender";
        const dtStart = new Date(e.start).toISOString().replace(/[-:]/g, "").split(".")[0] + "Z";
        const dtEndObj = new Date(e.end);
        dtEndObj.setDate(dtEndObj.getDate() + 1);
        const dtEnd = dtEndObj.toISOString().replace(/[-:]/g, "").split(".")[0] + "Z";
        const member = state.members.find(m => m.id === e.memberId);
        const summary = `${member?.name || "?"} – ${e.type}`;
        const desc = e.note ? e.note : "";
        ics += `BEGIN:VEVENT\nUID:${uid}\nDTSTART:${dtStart}\nDTEND:${dtEnd}\nSUMMARY:${summary}\nDESCRIPTION:${desc}\nEND:VEVENT\n`;
      });
      ics += "END:VCALENDAR";

      const blob = new Blob([ics], { type: "text/calendar" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "urlaubskalender.ics";
      a.click();
      URL.revokeObjectURL(url);
    }
    document.getElementById("btnICS").addEventListener("click", exportICS);

    renderAll();
  </script>
</body>
</html>
