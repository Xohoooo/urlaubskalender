<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Urlaubskalender</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f4f4f4; }
    header { background: #2c3e50; color: #fff; padding: 10px; text-align: center; }
    .controls { display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; margin: 15px; }
    button { padding: 8px 14px; border: none; border-radius: 8px; background: #3498db; color: white; cursor: pointer; }
    button:hover { background: #2980b9; }
    #calendar { margin: 20px auto; max-width: 1000px; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    table { border-collapse: collapse; width: 100%; font-size: 14px; }
    th, td { border: 1px solid #ddd; text-align: center; padding: 4px; min-width: 30px; }
    th { background: #eee; }
    .year-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
    .month-box { background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 8px; }
    .month-box h3 { margin: 0 0 5px; text-align: center; }
    .entry { display: inline-block; padding: 1px 4px; border-radius: 4px; margin: 1px; font-size: 11px; color: white; cursor: pointer; }
    .form-section { background: #fff; margin: 20px auto; max-width: 1000px; padding: 15px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .form-section h2 { margin-top: 0; }
    label { display: block; margin-top: 8px; }
    input, select { padding: 5px; margin-top: 3px; width: 100%; }
  </style>
</head>
<body>
  <script>
    // ðŸ”‘ Passwortschutz
    const pass = "2400";
    let input = prompt("Bitte Passwort eingeben:");
    if (input !== pass) {
      document.body.innerHTML = "<h2 style='text-align:center;margin-top:50px;'>Zugriff verweigert</h2>";
      throw new Error("Falsches Passwort");
    }
  </script>

  <header>
    <h1>Urlaubskalender</h1>
  </header>

  <div class="controls">
    <button onclick="prev()">â—€ ZurÃ¼ck</button>
    <button onclick="today()">Heute</button>
    <button onclick="next()">Vor â–¶</button>
    <button onclick="toggleView()">Ansicht wechseln</button>
    <button onclick="exportData()">Export</button>
    <button onclick="importData()">Import</button>
  </div>

  <div id="calendar"></div>

  <!-- Mitglieder-Form -->
  <div class="form-section">
    <h2>Teammitglied hinzufÃ¼gen</h2>
    <label>Name <input type="text" id="memberName"></label>
    <label>Farbe <input type="color" id="memberColor" value="#3498db"></label>
    <button onclick="addMember()">HinzufÃ¼gen</button>
  </div>

  <!-- Abwesenheit-Form -->
  <div class="form-section">
    <h2>Abwesenheit eintragen</h2>
    <label>Mitglied
      <select id="entryMember"></select>
    </label>
    <label>Art
      <select id="entryType">
        <option>Urlaub</option>
        <option>Krank</option>
        <option>Homeoffice</option>
      </select>
    </label>
    <label>Start <input type="date" id="entryStart"></label>
    <label>Ende <input type="date" id="entryEnd"></label>
    <label>Notiz <input type="text" id="entryNote"></label>
    <button onclick="addEntry()">Eintragen</button>
  </div>

  <script>
    // ---- Datenstruktur ----
    let state = JSON.parse(localStorage.getItem("urlaubskalender")) || { members: [], entries: [] };
    let currentDate = new Date();
    let viewMode = "month"; // "month" oder "year"

    // ---- Rendering ----
    function render() {
      const container = document.getElementById("calendar");
      container.innerHTML = "";

      if (viewMode === "month") {
        renderMonth(currentDate, container);
      } else {
        renderYear(currentDate.getFullYear(), container);
      }
      fillMemberSelect();
      localStorage.setItem("urlaubskalender", JSON.stringify(state));
    }

    function renderMonth(date, container) {
      const year = date.getFullYear();
      const month = date.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);

      let table = "<h2 style='text-align:center'>" +
                  date.toLocaleString("de-DE", { month: "long" }) +
                  " " + year + "</h2>";
      table += "<table><thead><tr>";
      const days = ["Mo", "Di", "Mi", "Do", "Fr", "Sa", "So"];
      days.forEach(d => table += "<th>" + d + "</th>");
      table += "</tr></thead><tbody><tr>";

      let startDay = (firstDay.getDay() + 6) % 7;
      for (let i = 0; i < startDay; i++) table += "<td></td>";

      for (let d = 1; d <= lastDay.getDate(); d++) {
        const dow = (startDay + d - 1) % 7;
        table += "<td>" + d;
        renderEntriesForDay(container, year, month, d, table);
        state.entries.forEach(e => {
          const sd = new Date(e.start);
          const ed = new Date(e.end);
          const thisDay = new Date(year, month, d);
          if (thisDay >= sd && thisDay <= ed) {
            const member = state.members.find(m => m.id === e.memberId);
            if (member) {
              table += `<div class='entry' style='background:${member.color}' onclick='deleteEntry("${e.id}")'>
                          ${member.name}
                        </div>`;
            }
          }
        });
        table += "</td>";
        if (dow === 6 && d !== lastDay.getDate()) table += "</tr><tr>";
      }

      table += "</tr></tbody></table>";
      container.innerHTML = table;
    }

    function renderYear(year, container) {
      let html = "<h2 style='text-align:center'>Jahresansicht " + year + "</h2>";
      html += "<div class='year-grid'>";
      for (let m = 0; m < 12; m++) {
        const date = new Date(year, m, 1);
        const firstDay = new Date(year, m, 1);
        const lastDay = new Date(year, m + 1, 0);

        let table = "<div class='month-box'><h3>" +
                    date.toLocaleString("de-DE", { month: "long" }) +
                    "</h3>";
        table += "<table><thead><tr>";
        const days = ["Mo", "Di", "Mi", "Do", "Fr", "Sa", "So"];
        days.forEach(d => table += "<th>" + d + "</th>");
        table += "</tr></thead><tbody><tr>";

        let startDay = (firstDay.getDay() + 6) % 7;
        for (let i = 0; i < startDay; i++) table += "<td></td>";

        for (let d = 1; d <= lastDay.getDate(); d++) {
          const dow = (startDay + d - 1) % 7;
          table += "<td style='font-size:10px'>" + d;
          state.entries.forEach(e => {
            const sd = new Date(e.start);
            const ed = new Date(e.end);
            const thisDay = new Date(year, m, d);
            if (thisDay >= sd && thisDay <= ed) {
              const member = state.members.find(m => m.id === e.memberId);
              if (member) {
                table += `<div class='entry' style='background:${member.color}' title='${member.name}'>
                            ${member.name[0]}
                          </div>`;
              }
            }
          });
          table += "</td>";
          if (dow === 6 && d !== lastDay.getDate()) table += "</tr><tr>";
        }

        table += "</tr></tbody></table></div>";
        html += table;
      }
      html += "</div>";
      container.innerHTML = html;
    }

    // ---- Member / Entry Funktionen ----
    function addMember() {
      const name = document.getElementById("memberName").value.trim();
      const color = document.getElementById("memberColor").value;
      if (!name) return;
      state.members.push({ id: Date.now().toString(), name, color });
      document.getElementById("memberName").value = "";
      render();
    }

    function fillMemberSelect() {
      const sel = document.getElementById("entryMember");
      sel.innerHTML = "";
      state.members.forEach(m => {
        sel.innerHTML += `<option value="${m.id}">${m.name}</option>`;
      });
    }

    function addEntry() {
      const memberId = document.getElementById("entryMember").value;
      const type = document.getElementById("entryType").value;
      const start = document.getElementById("entryStart").value;
      const end = document.getElementById("entryEnd").value;
      const note = document.getElementById("entryNote").value;
      if (!memberId || !start || !end) return;
      state.entries.push({ id: Date.now().toString(), memberId, type, start, end, note });
      render();
    }

    function deleteEntry(id) {
      if (confirm("Eintrag wirklich lÃ¶schen?")) {
        state.entries = state.entries.filter(e => e.id !== id);
        render();
      }
    }

    // ---- Import / Export ----
    function exportData() {
      const blob = new Blob([JSON.stringify(state)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.download = "urlaubskalender.json"; a.click();
    }

    function importData() {
      const input = document.createElement("input");
      input.type = "file"; input.accept = ".json";
      input.onchange = e => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = ev => { state = JSON.parse(ev.target.result); render(); };
        reader.readAsText(file);
      };
      input.click();
    }

    // ---- Navigation ----
    function prev() { 
      if (viewMode === "month") currentDate.setMonth(currentDate.getMonth() - 1);
      else currentDate.setFullYear(currentDate.getFullYear() - 1);
      render();
    }
    function next() { 
      if (viewMode === "month") currentDate.setMonth(currentDate.getMonth() + 1);
      else currentDate.setFullYear(currentDate.getFullYear() + 1);
      render();
    }
    function today() { currentDate = new Date(); render(); }
    function toggleView() { viewMode = (viewMode === "month") ? "year" : "month"; render(); }

    // ---- Start ----
    render();
  </script>
</body>
</html>
